<!-- chatbot/sidebar.html -->
<div class="card shadow-sm">
  <div class="card-header bg-primary text-white">
    <h5 class="mb-0">AI Assistant</h5>
  </div>
  <div class="card-body">
    <form id="chat-form">
      <div class="mb-2">
        <textarea class="form-control" id="user-input" rows="2" placeholder="Ask me something..."></textarea>
      </div>
      <button type="submit" class="btn btn-sm btn-primary w-100">Send</button>
    </form>
    <div id="chat-response" class="mt-3 small text-muted" style="min-height: 100px;"></div>
  </div>
</div>

<script>
  document.getElementById("chat-form").addEventListener("submit", function (e) {
    e.preventDefault();
    const input = document.getElementById("user-input").value;
    const responseDiv = document.getElementById("chat-response");
    responseDiv.innerHTML = "<em>Loading...</em>";

    fetch("/chatbot/ask/", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-CSRFToken": "{{ csrf_token }}"
      },
      body: JSON.stringify({ message: input })
    })
    .then(response => response.json())
    .then(data => {
      responseDiv.innerHTML = "<strong>Bot:</strong> " + data.response;
    })
    .catch(error => {
      responseDiv.innerHTML = "Something went wrong.";
    });
  });
</script>
